--- 
layout: post
title: Observer no Rails
tags: 
- oo
- rails
- ruby
status: publish
type: post
published: true
meta: 
  _edit_last: "597486"
image: obs  
---
No mundo do desenvolvimento de software existem uma série de design patters visando solucionar problemas que se repetem nas aplicações. O livro <a href="http://www.amazon.com/Design-Patterns-Ruby-Addison-Wesley-Professional/dp/0321490452">Design Patterns in Ruby</a> é bem legal e exemplifica uma séries dos patterns do GoF, inclusive citando as premissas de:

<ul>
	<li>Separate Out the Things That Change from Those 
That Stay the Same </li>
	<li>Program to an Interface, Not an Implementation </li>
	<li>Prefer Composition over Inheritance </li>
	<li>Delegate, Delegate, Delegate</li>
</ul>

e cita mais uma:
<ul>
	<li>You Ain’t Gonna Need It (YAGNI )</li>
</ul>

Mas vou falar mesmo sobre um pattern que pode ser facilmente aplicado no Rails, usando ActiveRecord::Observer.

Da wikipedia:
Observer: “The observer pattern (sometimes known as publish/subscribe) is a software design pattern in which an object, called the subject, maintains a list of its dependents, called observers, and notifies them automatically of any state changes, usually by calling one of their methods. It is mainly used to 
implement distributed event handling systems.” 
  
Vamos criar um cadastro de usuário, simples com scaffold para por em prática o <strong>Observer</strong>.
Quando um usuário for criado, o Rails imprimirá uma mensagem de log no servidor ( você poderia implementar algo mais avançado depois ).

<em>1)</em> Gere o crud de Usuário:
<code>script/generate scaffold Usuario nome:string
rake db:create:all
rake db:migrate</code>

<em>2)</em> Para gerar um observer o rails disponibiliza um script. Apenas passe o nome do model como paramêtro.
<code>script/generate observer Usuario</code>

<em>3) </em>O Rails vai criar a classe usuario_observer.rb em app/models. Abra a classe e adicione o método<em> after_create</em>, como abaixo:

<a href="http://andersonleiteblog.files.wordpress.com/2009/07/picture-1.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/07/picture-1.png?w=300" alt="Picture 1" title="Picture 1" width="300" height="131" class="aligncenter size-medium wp-image-113" /></a>

<em>4) </em>Para habilitar o observer, abra o config/environment.rb e adicione a seguinte linha:
<code>config.active_record.observers = :usuario_observer</code>

<em>5)</em> Inicie o servidor e cadastre um usuário (http://localhost:3000/usuarios).
Verifique o log do servidor para ver a mensagem que imprimimos, para ver que o Rails chamou o <strong>Observer</strong>.

<a href="http://andersonleiteblog.files.wordpress.com/2009/07/picture-2.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/07/picture-2.png" alt="Picture 2" title="Picture 2" width="220" height="202" class="aligncenter size-full wp-image-119" /></a>
