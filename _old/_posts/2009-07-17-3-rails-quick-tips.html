--- 
layout: post
title: 3 Rails Quick Tips
tags: 
- rails
status: publish
type: post
published: true
meta: 
  _edit_last: "597486"
image: ror
---


<blockquote><strong>Tip 1:</strong> Visualizar LOGS da aplicação direto no browser</blockquote>



Em primeiro lugar, abra o <strong>config/environments/production.rb</strong> e altere o config.level para <strong>warning</strong>.

<code>
config.log_level = :warn
</code>

Crie um controller para a página de logs
<code>script/generate controller logs index</code>

No controller vamos adicionar actions para buscar o conteúdo, limpar o log e fazer backup. Você pode adicionar um filtro de autorização para controlar o acesso aos logs.

<code>class LogsController  adicione alguma autenticação
  LOG_PATH = "#{Rails.root}/log/#{Rails.env}.log"
  
  def index
    @log_content = File.read(LOG_PATH)
    @log_size = File.size?(LOG_PATH).to_f/1048576 #converts file size to MB 
  end
  
  def backup
    send_file LOG_PATH, 
      :type =&gt; "text/plain",
      :stream =&gt; false,
      :filename =&gt; "log_backup_#{Date.today}"
  end

  def clear
    File.open(LOG_PATH, "w") do |log_file|
      log_file.write "Log file cleared at #{Time.now}\n"
    end
    flash[:notice]  = "log was cleared\n"
    redirect_to log_path
  end
end</code>

Precisamos criar uma rota para a página de log. Altere o arquivo <strong>/config/routes.rb</strong>

<code>map.with_options :controller =&gt; "logs" do |logs|
  logs.log "log", :action =&gt; "index"
  logs.clear_log "clear_log", :action =&gt; "clear"
  logs.backup_log "backup_log", :action =&gt; "backup"
end
</code>

Por último, crie a página que mostra os logs no browser. A página fica em <strong>views/logs/index.html.erb</strong>:

&lt;p&gt;Log size: &lt;%= "%0.3f" % @log_size %&gt;MB&lt;/p&gt;
&lt;p&gt;
  &lt;%= link_to "clear log", clear_log_path, :confirm =&gt; "Are you sure you want to clear the log?" %&gt; |
  &lt;%= link_to "backup log", backup_log_path %&gt;
&lt;/p&gt;
&lt;pre&gt;
&lt;%= @log_content %&gt;
&lt;/pre&gt;




<blockquote><strong>Tip 2:</strong> Fazendo mensagens flash do Rails sumirem após certo intervalo
Para testar, crie um controller que sete uma <strong>flash[:notice]</strong></blockquote>



class FlashController &lt; ApplicationController
  def index
    
    flash[:notice] = "Coloque aqui a mensagem"
    
  end

end

Na view, importe os javascripts
<code>
&lt;%= javascript_include_tag :all %&gt;
</code>

e use os efeitos do scriptaculos:
<code>
&lt;%- flash.each do |flash_type, message| -%&gt;
  &lt;%= content_tag :div, message, :class =&gt; "flash", :id =&gt; flash_type %&gt;
  &lt;% content_tag :script, :type =&gt; "text/javascript" do %&gt;
    setTimeout("new Effect.Fade('&lt;%= flash_type %&gt;');", 1000);
  &lt;% end %&gt;
&lt;%- end -%&gt;
</code>


<blockquote><strong>Tip 3:</strong> Usando o <em>RDoc</em></strong></blockquote>
Essa é amais simples, mas alguns podem não conhecer.
Para gerar uma documentação do seu software semelhante a do Ruby, coloque os comentários como abaixo:

<code>
# User records should require:
# * first_name
# * last_name
# * email
# all other attributes are optional
class User &lt; ActiveRecord::Base
  
  # returns the first_name and last_name attributes separated by a space
  def name
    "#{first_name} #{last_name}"
  end
  
end
</code>

Para gerar, no terminal rode <strong>rake doc:app</strong>
Sua app rails terá a documentação em HTML no diretório <strong>/docs</strong>
