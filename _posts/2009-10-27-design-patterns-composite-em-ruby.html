--- 
layout: post
title: "Design Patterns: Composite em Ruby"
tags: 
- oo
- ruby
status: publish
type: post
published: true
meta: 
  _edit_last: "597486"
image: composite
---
A idéia de componentes sendo construídos a partir de "sub componentes" é algo bem comum em um software. Construir objetos a partir de "sub objetos" é o que sugere o padrão <b>Composite</b>, ou seja, objetos simples se integrando para resultar em um mais complexo e  interessante para o sistema.

Vamos pegar um exemplo:

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/composite.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/composite.png" alt="composite" title="composite" width="400" height="300" class="aligncenter size-full wp-image-292" /></a>

Contruir um <b>Copo de suco</b> é uma composição de uma série de <b>tarefas</b>.
Uma dos pontos positivos aqui é que qualquer objeto do sistema que precisar do <b>CopoDeSuco</b> não precisa se preocupar com a complexidade da criação desse objeto.
<a href="http://andersonleiteblog.files.wordpress.com/2009/10/ingredientes.jpg"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/ingredientes.jpg" alt="ingredientes" title="ingredientes" width="468" height="314" class="aligncenter size-full wp-image-302" /></a>


<blockquote>
Show me the code!
</blockquote>

O GoF chama essa situação de "the sum acts like one of the parts". Primeiro precisamos de uma interface comum aos objetos. Essa interface é chamada de <b>component</b>.

Cada tarefa "indivisível" do processo é chamada de <b>leaf</b>. Cada um desses objetos deve implementar a interface acima.

O <b>Composite</b>, enfim, é o componente no nível mais alto da hierarquia.


<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-11.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-11.png" alt="Picture 1" title="Picture 1" width="480" height="183" class="aligncenter size-full wp-image-293" /></a>

Nossa tarefa tem apenas um initialize e uma método "duracao". Obviamente poderia ter muitas outras características.

Vamos a criação das tarefas:

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-22.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-22.png" alt="Picture 2" title="Picture 2" width="480" height="276" class="aligncenter size-full wp-image-294" /></a>


<b>AdicionarIngredientes</b> e <b>Mistura</b> são dois <i>leafs</i>, ou seja, duas tarefas que não dividimos nesse modelo. Vamos criar um <i>component</i> a partir desses objetos. 

O objeto <b>Suco</b> é o resultado dessa composição. Ao criarmos esse  componente, precisamos de um array de sub tarefas. Criaremos os métodos que adicionam e removem essas sub tarefas.

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-31.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-31.png" alt="Picture 3" title="Picture 3" width="480" height="308" class="aligncenter size-full wp-image-295" /></a>

Para evitar duplicação de código, vamos extrair um component e criaremos a classe <b>Composite</b>.

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-42.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-42.png" alt="Picture 4" title="Picture 4" width="480" height="287" class="aligncenter size-full wp-image-296" /></a>

Aplicando a mesma lógica agora temos a classe <b>Suco</b> da seguinte forma:

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-51.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-51.png" alt="Picture 5" title="Picture 5" width="480" height="120" class="aligncenter size-full wp-image-297" /></a>

E aplicamos a mesma idéia a classe <b>CopoDeSuco</b>. Essa classe é uma composição entre um <b>component</b> e um <b>leaf</b>.

<a href="http://andersonleiteblog.files.wordpress.com/2009/10/picture-61.png"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/picture-61.png" alt="Picture 6" title="Picture 6" width="480" height="129" class="aligncenter size-full wp-image-298" /></a>

Nossa classe composite poderia ter herdado diretamente de Array para receber  os métodos que precisamos, porém essa seria uma implementação estranha. Um composite não é um tipo "especializado" de array, e estariamos utilizando a herança apenas por preguiça fazendo isso.


<a href="http://andersonleiteblog.files.wordpress.com/2009/10/suco.jpg"><img src="http://andersonleiteblog.files.wordpress.com/2009/10/suco.jpg" alt="suco" title="suco" width="270" height="270" class="aligncenter size-full wp-image-305" /></a>
